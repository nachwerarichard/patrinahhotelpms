<html>
  <head>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body> 
  <div class="p-6 bg-gray-100 min-h-screen">
    <h1 class="text-2xl font-bold mb-6 text-gray-800">Kitchen Display (KDS)</h1>
    <div id="kitchenOrders" class="grid grid-cols-1 md:grid-cols-3 gap-6">
        </div>
</div>

<script>
async function loadOrders() {
    try {
        const res = await fetch('https://patrinahhotelpms.onrender.com/api/kitchen/Pending', {
            headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        
        if (!res.ok) throw new Error("Could not fetch orders");
        
        const orders = await res.json();
        console.log("Orders received:", orders); // Check your console!

        const container = document.getElementById('kitchenOrders');
        
        if (orders.length === 0) {
            container.innerHTML = `<p class="col-span-full text-center text-gray-500 py-10">No pending orders. Take a break, Chef!</p>`;
            return;
        }

        container.innerHTML = orders.map(order => `
            <div class="bg-white p-5 rounded-2xl shadow-lg border-l-8 border-orange-500">
                <div class="flex justify-between items-start">
                    <h2 class="text-xl font-black">${order.item}</h2>
                    <span class="text-xs bg-gray-100 p-1 rounded font-mono">T: ${order.tableNumber || 'N/A'}</span>
                </div>
                <p class="text-3xl font-bold my-2">QTY: ${order.number}</p>
                <p class="text-sm text-gray-400 mb-4">Waiter: ${order.waiter || 'Unknown'}</p>
                
                <button onclick="completeOrder('${order._id}')" 
                    class="w-full bg-green-600 text-white py-3 rounded-xl font-bold hover:bg-green-700 active:scale-95 transition">
                    MARK AS READY
                </button>
            </div>
        `).join('');
    } catch (err) {
        console.error("Kitchen Display Error:", err);
    }
}

async function completeOrder(id) {
    try {
        // Fixed the backtick syntax here
        const res = await fetch(`https://patrinahhotelpms.onrender.com/api/kitchen/order/${id}/ready`, {
            method: 'PATCH',
            headers: { 'Authorization': `Bearer ${localStorage.getItem('token')}` }
        });
        if (res.ok) {
            loadOrders(); 
        } else {
            alert("Error marking order as ready");
        }
    } catch (err) {
        console.error("Complete Order Error:", err);
    }
}

// Refresh every 10 seconds (faster for kitchen)
setInterval(loadOrders, 10000);
loadOrders();
</script>
  </body>
</html>
