
<html>
  <head>
        <script src="https://cdn.tailwindcss.com"></script>

  </head>
<body>
<div class="p-8 bg-gray-50 min-h-screen font-sans">
  <div class="max-w-4xl mx-auto space-y-8">
    
    <section class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-xl font-bold text-gray-800 mb-4">1. Define Room Type & Default Rate</h2>
      <form id="typeForm" class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <input type="text" id="typeName" placeholder="Type (e.g. Suite)" class="p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
        <input type="number" id="basePrice" placeholder="Base Price ($)" class="p-2 border rounded-lg focus:ring-2 focus:ring-blue-500 outline-none">
        <button type="submit" class="bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition">Save Type</button>
      </form>
    </section>

    <section class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
      <h2 class="text-xl font-bold text-gray-800 mb-4">2. Set Seasonal Pricing</h2>
      <form id="seasonForm" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        <select id="targetType" class="p-2 border rounded-lg"></select>
        <input type="text" id="seasonName" placeholder="Season (e.g. Summer)" class="p-2 border rounded-lg">
        <input type="date" id="startDate" class="p-2 border rounded-lg text-sm">
        <input type="date" id="endDate" class="p-2 border rounded-lg text-sm">
        <input type="number" id="seasonRate" placeholder="Seasonal Price ($)" class="p-2 border rounded-lg col-span-full md:col-span-1">
        <button type="submit" class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition col-span-full">Apply Seasonal Rate</button>
      </form>
    </section>

    <section class="bg-white p-6 rounded-xl shadow-md border border-gray-200">
  <h2 class="text-xl font-bold text-gray-800 mb-4">Add Physical Room</h2>
  <form id="roomForm" class="flex flex-col md:flex-row gap-4">
    <input type="text" id="roomNumber" placeholder="Room # (e.g. 101)" 
           class="p-2 border border-gray-300 rounded-lg flex-1 outline-none focus:ring-2 focus:ring-green-500">
    
    <select id="roomTypeSelect" class="p-2 border border-gray-300 rounded-lg flex-1 outline-none">
      <option value="">Select Room Type...</option>
    </select>
    
    <button type="submit" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg transition-colors">
      Add Room
    </button>
  </form>
</section>
  </div>
</div>

<script>
                  const BASE_URL = 'https://patrinahhotelpms.onrender.com';

  // --- Logic for defining Room Types ---
// Ensure BASE_URL is defined at the top of your script

document.getElementById('typeForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const data = {
        name: document.getElementById('typeName').value,
        basePrice: document.getElementById('basePrice').value
    };
    
    // Note the backticks below!
    try {
        const res = await fetch(`${BASE_URL}/api/room-types`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        if(res.ok) {
            alert("Room Type Created!");
            loadRoomTypes(); // Refresh your dropdowns
        } else {
            console.error("Server responded with an error");
        }
    } catch (error) {
        console.error("Failed to connect to the server:", error);
    }
});

// --- Logic for Seasonal Rates ---
document.getElementById('seasonForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const typeId = document.getElementById('targetType').value;
    const data = {
        seasonName: document.getElementById('seasonName').value,
        startDate: document.getElementById('startDate').value,
        endDate: document.getElementById('endDate').value,
        rate: document.getElementById('seasonRate').value
    };

    const res = await fetch(`${BASE_URL}/api/room-types/${typeId}/seasons`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
    if(res.ok) alert("Season Applied!");
});

// Function to handle adding a room
document.getElementById('roomForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const roomData = {
        number: document.getElementById('roomNumber').value,
        roomTypeId: document.getElementById('roomTypeSelect').value // Sending the ID, not the name
    };

    const res = await fetch(`${BASE_URL}/api/rooms`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(roomData)
    });

    if (res.ok) {
        alert("Room added successfully!");
        e.target.reset();
    } else {
        const error = await res.json();
        alert("Error: " + error.error);
    }
});

  // Add this to your existing <script> block
async function loadRoomTypes() {
    try {
        const response = await fetch(`${BASE_URL}/api/room-types`);
        if (!response.ok) throw new Error('Failed to fetch types');
        
        const types = await response.json();
        
        // Target both dropdown IDs
        const seasonSelect = document.getElementById('targetType');
        const roomSelect = document.getElementById('roomTypeSelect');

        // Create the HTML options
        const optionsHTML = types.map(t => 
            `<option value="${t._id}">${t.name} (Base: $${t.basePrice})</option>`
        ).join('');

        // Inject into dropdowns
        if (seasonSelect) seasonSelect.innerHTML = `<option value="">Select Room Type...</option>` + optionsHTML;
        if (roomSelect) roomSelect.innerHTML = `<option value="">Select Room Type...</option>` + optionsHTML;
        
        console.log("Dropdowns updated with", types.length, "types");
    } catch (error) {
        console.error("Error loading dropdowns:", error);
    }
}

// CRITICAL: Call this function as soon as the page loads!
window.onload = loadRoomTypes;
  
</script>
  </body>
</html>
